installation:
  download:
    template: "https://github.com/graalvm/graalvm-ce-builds/releases/download/{version}/graalvm-community-{version}_{os}-{arch}_bin.tar.gz"
    mappings:
      os:
        linux: "linux"
        mac: "macos"
      arch:
        x86_64: "x64"
        amd64: "x64"
        arm64: "aarch64"
        aarch64: "aarch64"

    # Optional: override specific versions with explicit URLs
    # "17":
    #   linux-x64: "https://github.com/graalvm/graalvm-ce-builds/releases/download/jdk-17.0.9/graalvm-community-jdk-17.0.9_linux-x64_bin.tar.gz"
    # "21":
    #   linux-x64: "https://github.com/graalvm/graalvm-ce-builds/releases/download/jdk-21.0.2/graalvm-community-jdk-21.0.2_linux-x64_bin.tar.gz"

  # Optional post-installation steps
  post_installation_script: |
    #!/bin/bash
    echo "Installing custom certificates if needed..."
    echo "Package installed in ${install_dir}"

configuration:
  # Default version using environment variable or fallback to latest from GitHub
  default_version: "${JDK_VERSION:-$(curl -s https://api.github.com/repos/graalvm/graalvm-ce-builds/releases/latest | jq -r '.tag_name')}"

  # Optional post-configuration steps
  post_configuration_script: |
    if [ -d "${install_dir}/Contents" ]; then
      echo "Detected macOS JDK layout, reorganizing..."
      
      # Move everything from Contents/Home to install_dir
      shopt -s dotglob nullglob  # include hidden files
      mv "${install_dir}/Contents/Home/"* "${install_dir}/"
      shopt -u dotglob nullglob
      
      # Remove the Contents folder
      rm -rf "${install_dir}/Contents"
      
      echo "Reorganized macOS JDK to standard layout in ${install_dir}"
    fi

    echo "Installed Java/GraalVM version: ${install_dir}"
    create_symlinks_to_bin $source_folder/bin
    
    export PATH="${install_dir}/bin:$PATH"    
    export JAVA_HOME="${install_dir}"
    export GRAALVM_HOME="${install_dir}"
    echo ""
    echo ""
    cat $PATH
    echo ""
    echo ""
    java -version
    echo "Java binary path:"
    which java || whereis java