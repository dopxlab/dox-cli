configure: |
  dox configure helm
  dox export global-vars 

template_folder: "${DOX_CUSTOM_DIR}/action/templates/helm" # ${template_folder} will be resolved path of the template folder 

variables:
  BUILD_VERSION: "${BUILD_VERSION:-1.0.0}"

  CHART_VERSION: ${BUILD_VERSION}-helm
  GIT_DIR: "${GITHUB_WORKSPACE}/.git"
  NAMESPACE: "${NAMESPACE:-default}"
  DOCKER_IMAGE_PUSH_PREFIX: "${DOCKER_IMAGE_PUSH_PREFIX:-docker.io/myusername}"  # DOCKER_HOST
  CUSTOM_PROJECT_VARIABLES: "${CUSTOM_PROJECT_VARIABLES:-}"
  IMAGE_TAG: "${BUILD_VERSION:-}"
  IMAGE_PULL_POLICY: "${IMAGE_PULL_POLICY:-Always}"
  IMAGE_PULL_SECRETS: "${IMAGE_PULL_SECRETS:-image-pull-secret}"

  APPLICATION_NAME: "${APPLICATION_NAME:-$GIT_REPOSITORY_NAME}"
  APPLICATION_PORT: "${APPLICATION_PORT:-8080}"
  APPLICATION_HEALTH_PORT: "${APPLICATION_HEALTH_PORT:-$APPLICATION_PORT}"
  APPLICATION_HEALTH_LIVENESS_PATH: "${APPLICATION_HEALTH_LIVENESS_PATH:-/actuator/info}"
  APPLICATION_HEALTH_LIVENESS_DELAY: "${APPLICATION_HEALTH_LIVENESS_DELAY:-40}"
  APPLICATION_HEALTH_READINESS_PATH: "${APPLICATION_HEALTH_READINESS_PATH:-/actuator/health}"
  APPLICATION_HEALTH_READINESS_DELAY: "${APPLICATION_HEALTH_READINESS_DELAY:-40}"

  RESOURCE_REQUESTS_CPU: "${RESOURCE_REQUESTS_CPU:-200m}"
  RESOURCE_REQUESTS_MEMORY: "${RESOURCE_REQUESTS_MEMORY:-512Mi}"
  RESOURCE_LIMITS_CPU: "${RESOURCE_LIMITS_CPU:-500m}"
  RESOURCE_LIMITS_MEMORY: "${RESOURCE_LIMITS_MEMORY:-1Gi}"
  AUTOSCALING_ENABLED: "${AUTOSCALING_ENABLED:-true}"

  HELM_EXPERIMENTAL_OCI: "${HELM_EXPERIMENTAL_OCI:-1}"
  HELM_OCI_URL: "${HELM_OCI_URL:-oci://${DOCKER_IMAGE_PUSH_PREFIX:-}}"

  INGRESS_HOST: "${INGRESS_HOST:-}"
  IMAGE_PULL_SECRET: "${IMAGE_PULL_SECRET:-}"
  CONFIG_MAP_REF_NAME: "${CONFIG_MAP_REF_NAME:-}"
  SECRETS_REF_NAME: "${SECRETS_REF_NAME:-}"
  ENVIRONMENT_STAGE: "${ENVIRONMENT_STAGE:-unknown}"
  PERSISTENT_VOLUME_CLAIM: "${PERSISTENT_VOLUME_CLAIM:-}"
  
  MAINTAINER_NAME: "${GIT_COMMITTER_NAME:-Dox Engine}"
  MAINTAINER_EMAIL: "${GIT_COMMITTER_EMAIL:-johndoe@example.com}"
  ENVIORNMENT_STAGE: "unknown"

actions:
  template: |
    helm template ${template_folder}
  package: |
    helm package ${template_folder}
  push: |
    helm push $helm_chart $HELM_OCI_URL;