configure: |
  dox configure docker
  echo "$OCI_REG_PASSWORD" | docker login -u "$OCI_REG_USER" --password-stdin ${OCI_REG_HOST:-docker.io}

  dox export GIT_REPOSITORY_NAME
  dox export BUILD_VERSION

template:
  folder: "${DOX_CUSTOM_DIR}/action/templates/docker-gv" # ${template_folder} will be resolved path of the template folder 

actions:
  cat_dockerfile: |
    debug ${template_folder}/Dockerfile

  build: |
    BINARY_NAME=$(find target -maxdepth 1 -type f -perm -111 ! -name "*.jar" -exec basename {} \;)

    if [ -z "$BINARY_NAME" ]; then
        echo "❌ No native binary found in target/"
        exit 1
    fi

    echo "✅ Native binary is: $BINARY_NAME"

    mv "./target/$BINARY_NAME" "./target/graalvm_app"

    docker build -t ${DOCKER_IMAGE_PUSH_PREFIX}/${GIT_REPOSITORY_NAME}:${BUILD_VERSION} .
  push: |
    docker push ${DOCKER_IMAGE_PUSH_PREFIX}/${GIT_REPOSITORY_NAME}:${BUILD_VERSION}